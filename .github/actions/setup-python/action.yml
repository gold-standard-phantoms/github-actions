name: "Setup Python Environment"
description: "Set up Python environment for the given Python version"

inputs:
  UV_INDEX:
    description: "The URL(s) for the Python package index, including any authentication"
    required: false
    default: "https://pypi.org/simple"
    type: string
    # Examples:
    # - Default (public PyPI only):
    #   UV_INDEX: "https://pypi.org/simple"
    # - Private PyPI with auth:
    #   UV_INDEX: "https://user:pass@private.pypi.com/simple https://pypi.org/simple"
    # - Multiple indexes:
    #   UV_INDEX: "https://private.pypi.com/simple https://other.pypi.com/simple https://pypi.org/simple"
  
  python_version:
    description: "Python version(s) to install. Multiple versions can be specified using newlines."
    required: false
    default: "3.11"
    type: string
    # Examples:
    # - Single version:
    #   python_version: "3.9"
    # - Multiple versions (last one is default):
    #   python_version: |
    #     3.11
    #     3.10
    #     3.9

  install_deps:
    description: "Whether to install project dependencies"
    required: false
    default: "false"
    type: string

  install_dev_deps:
    description: "Whether to install development dependencies (only applies if install_deps is true)"
    required: false
    default: "false"
    type: string

  working_directory:
    description: "Working directory for the Python project (useful for monorepos)"
    required: false
    default: "."
    type: string

runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python_version }}

    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        version: "latest"
        enable-cache: "true"

    - name: Install project dependencies
      if: inputs.install_deps == 'true'
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      env:
        UV_INDEX: ${{ inputs.UV_INDEX }}
      run: |
        if [ "${{ inputs.install_dev_deps }}" = "true" ]; then
          uv sync --frozen
        else
          uv sync --frozen --no-dev
        fi
