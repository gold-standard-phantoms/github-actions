name: "Setup and Run Tests"
description: "Sets up the Python environment and runs tests with tox"

inputs:
  UV_INDEX:
    description: "The URL(s) for the Python package index, including any authentication"
    required: true
    type: string

  working_directory:
    description: "Working directory for the Python project (useful for monorepos)"
    required: false
    default: "."
    type: string

runs:
  using: "composite"
  steps:
    - name: Setup Python Environment
      uses: gold-standard-phantoms/github-actions/.github/actions/setup-python@v0.3.0
      with:
        UV_INDEX: ${{ inputs.UV_INDEX }}
        working_directory: ${{ inputs.working_directory }}

    - name: Install tox
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: uv tool install tox --with tox-uv

    - name: Run tests with tox
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      env:
        UV_INDEX: ${{ inputs.UV_INDEX }}
        UV_NO_CACHE: "1"
      run: uv run tox
